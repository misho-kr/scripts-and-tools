---
# Create Virtual Machines

- template: src=vm.xml.j2
            dest="{{ cloud_init_dir }}/vm-{{ item }}.xml"
  with_sequence: count={{ vm_count }}
  sudo: yes

- name: define virtual machines
  virt: name="coreos-{{ item }}"
        command=define
        xml="{{ lookup('template', '../templates/vm.xml.j2') }}"
        uri=qemu:///system
  with_sequence: count={{ vm_count }}

- name: create virtual machines
  virt: name="coreos-{{ item }}"
        command=create 
        state=running
  with_sequence: count={{ vm_count }}
